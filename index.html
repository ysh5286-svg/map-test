<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ëŒ€êµ¬í•«í”Œì—¬ê¸° ë³´ë¬¼ì§€ë„</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#c0392b">
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=krsv42ftzf&submodules=geocoder"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
    @media (max-width: 768px) {
        #userStatusCard { top: 240px !important; left: 50% !important; transform: translateX(-50%) !important; width: 90% !important; justify-content: center !important; }
    }
    /* í”„ë¡œí•„ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .profile-header { text-align: center; margin-bottom: 20px; }
    .profile-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #3498db; margin-bottom: 10px; }
    .profile-name { font-size: 18px; font-weight: bold; color: #333; }
    .profile-level { color: #3498db; font-weight: bold; font-size: 14px; }
    .exp-bar-bg { width: 100%; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; margin: 10px 0; }
    .exp-bar-fill { height: 100%; background: #3498db; width: 0%; transition: width 0.5s; }
    .history-list { max-height: 200px; overflow-y: auto; background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 13px; }
    .history-item { padding: 8px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <div id="loadingOverlay"><div class="spinner"></div><p>ğŸ’ ë³´ë¬¼ì§€ë„ë¥¼ í¼ì¹˜ëŠ” ì¤‘...</p></div>

    <div class="search-container">
        <div class="search-box-wrapper">
            <div class="theme-select-wrapper">
                <select id="mainThemeSelect" class="theme-select" onchange="applyAllFilters()">
                    </select>
            </div>
            <div class="search-filters">
                <select id="filterRegion" class="search-select" onchange="applyAllFilters()"><option value="">ğŸ“ ì§€ì—­ ì „ì²´</option><option value="ìˆ˜ì„±êµ¬">ìˆ˜ì„±êµ¬</option><option value="ì¤‘êµ¬">ì¤‘êµ¬</option><option value="ë™êµ¬">ë™êµ¬</option><option value="ì„œêµ¬">ì„œêµ¬</option><option value="ë‚¨êµ¬">ë‚¨êµ¬</option><option value="ë¶êµ¬">ë¶êµ¬</option><option value="ë‹¬ì„œêµ¬">ë‹¬ì„œêµ¬</option><option value="ë‹¬ì„±êµ°">ë‹¬ì„±êµ°</option><option value="êµ°ìœ„êµ°">êµ°ìœ„êµ°</option><option value="ì¹ ê³¡êµ°">ì¹ ê³¡êµ°</option><option value="ê²½ì‚°">ê²½ì‚°</option><option value="ì²­ë„">ì²­ë„</option><option value="ëŒ€êµ¬ ë°–">ëŒ€êµ¬ ë°–</option></select>
                <select id="filterCategory" class="search-select" onchange="applyAllFilters()"><option value="">ğŸœ ì—…ì¢… ì „ì²´</option><option value="í•œì‹">í•œì‹</option><option value="ì¤‘ì‹">ì¤‘ì‹</option><option value="ì¼ì‹">ì¼ì‹</option><option value="ì–‘ì‹">ì–‘ì‹</option><option value="ë¶„ì‹">ë¶„ì‹</option><option value="ê³ ê¸°/êµ¬ì´">ê³ ê¸°/êµ¬ì´</option><option value="íšŒ/í•´ì‚°ë¬¼">íšŒ/í•´ì‚°ë¬¼</option><option value="ì•„ì‹œì•ˆ">ì•„ì‹œì•ˆ</option><option value="ìˆ ì§‘">ìˆ ì§‘</option><option value="ì¹´í˜/ë””ì €íŠ¸">ì¹´í˜/ë””ì €íŠ¸</option><option value="ë¹µì§‘">ë¹µì§‘</option><option value="íŒ¨ìŠ¤íŠ¸í‘¸ë“œ">íŒ¨ìŠ¤íŠ¸í‘¸ë“œ</option><option value="í¬ì¥/ë°°ë‹¬">í¬ì¥/ë°°ë‹¬</option></select>
                <select id="filterPurpose" class="search-select" onchange="applyAllFilters()"><option value="">âœ¨ ë¶„ìœ„ê¸° ì „ì²´</option><option value="ë…¸í¬">ë…¸í¬</option><option value="ë°ì´íŠ¸">ë°ì´íŠ¸</option><option value="ë‹¨ì²´íšŒì‹">ë‹¨ì²´íšŒì‹</option><option value="í˜¼ë°¥/í˜¼ìˆ ">í˜¼ë°¥/í˜¼ìˆ </option><option value="ë¬´í•œë¦¬í•„">ë¬´í•œë¦¬í•„</option><option value="ì´ìƒ‰ë§›ì§‘">ì´ìƒ‰ë§›ì§‘</option><option value="ë·°ë§›ì§‘">ë·°ë§›ì§‘</option><option value="ìƒê²¬ë¡€">ìƒê²¬ë¡€</option><option value="ì•¼ê°„ì˜ì—…">ì•¼ê°„ì˜ì—…</option></select>
            </div>
            <div class="search-input-row" style="display:flex; align-items:center;">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="keyword" class="search-input" placeholder="ì˜ˆ: ë™ì„±ë¡œ ë‘ë°”ì´" onchange="applyAllFilters()" style="flex:1;">
                <button id="btnShowLikes" onclick="toggleLikeFilter()" style="background:white; border:1px solid #e74c3c; color:#e74c3c; border-radius:20px; padding:6px 12px; font-size:12px; font-weight:bold; cursor:pointer; margin-left:8px; white-space:nowrap; flex-shrink:0; box-shadow:0 1px 3px rgba(0,0,0,0.1);">ğŸ¤ ì°œë§Œ ë³´ê¸°</button>
            </div>
        </div>
    </div>

    <div id="userStatusCard" style="position: absolute; top: 150px; right: 10px; z-index: 90; display:flex; justify-content: flex-end; width: auto;">
        <button id="btnLogin" onclick="googleLogin()" style="background:white; border:1px solid #ddd; padding:8px 12px; border-radius:20px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.1); cursor:pointer; display:flex; align-items:center; gap:5px; color:#444;">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> êµ¬ê¸€ ë¡œê·¸ì¸
        </button>
        <div id="myProfile" onclick="openProfileModal()" style="display:none; background:white; border:1px solid #3498db; padding:6px 12px; border-radius:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1); align-items:center; gap:8px; cursor: pointer;">
            <span id="userLevelBadge" style="background:#3498db; color:white; font-size:11px; padding:2px 6px; border-radius:10px; font-weight:bold;">LV.1</span>
            <span id="userName" style="font-size:13px; font-weight:bold; color:#333;">í™ê¸¸ë™</span>
        </div>
    </div>

    <div id="faqPanel" class="faq-panel">
        <div class="faq-header"><h3>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h3><button class="faq-close" onclick="toggleFaq()">âœ•</button></div>
        <div class="faq-body">
            <div class="faq-item"><div class="faq-q">Q. 'ëŒ€êµ¬ë³´ë¬¼ì§€ë„'ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</div><div class="faq-a">ëŒ€êµ¬ ì°ë§›ì§‘ ì •ë³´ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</div></div>
            <div class="faq-item"><div class="faq-q">Q. ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ì„ ì •ë˜ë‚˜ìš”?</div><div class="faq-a">'ëŒ€êµ¬ ì°ë§›ì§‘ í‰ê°€ë‹¨'ì´ ì§ì ‘ ê²€ì¦í•˜ê³  ì—„ì„ í•œ ë¡œì»¬ ì°ë§›ì§‘ & í•«í”Œë§Œ ëª¨ì•˜ìŠµë‹ˆë‹¤.</div></div>
            <div class="faq-item"><div class="faq-q">Q. ìš°ë¦¬ ê°€ê²Œë„ ë“±ë¡í•˜ê³  ì‹¶ì–´ìš”!</div><div class="faq-a">ì˜¤í”ˆì±„íŒ… [ëŒ€êµ¬ ì°ë§›ì§‘ ì†Œí†µë°©]ì—ì„œ ìš”ì²­í•´ì£¼ì„¸ìš”.</div></div>
            <div class="faq-item">
                <div class="faq-q">ğŸ† ë ˆë²¨ì€ ì–´ë–»ê²Œ ì˜¬ë¦¬ë‚˜ìš”?</div>
                <div class="faq-a">
                    ê°€ê²Œì— ë„ì°©í•´ì„œ <b>[ğŸ“ ì—¬ê¸° ì™”ì–´ìš”! (GPS ì¸ì¦)]</b> ë²„íŠ¼ë§Œ ëˆ„ë¥´ë©´ ë!<br>(ë°©ë¬¸ 1íšŒ = ê²½í—˜ì¹˜ 10ì  íšë“ ğŸ)
                    <div class="level-box" style="margin-top:10px; background:#f8f9fa; padding:10px; border-radius:8px; border:1px solid #eee;">
                        <div class="lv-row"><span class="lv-badge lv1">LV.1</span> ê°€ì… ì¦‰ì‹œ (ë°°ê³ í”ˆ ì˜í˜¼)</div>
                        <div class="lv-row"><span class="lv-badge lv2">LV.2</span> ë°©ë¬¸ 5íšŒ (ì„œíˆ° ë¯¸ì‹ê°€)</div> <div class="lv-row"><span class="lv-badge lv3">LV.3</span> ë°©ë¬¸ 10íšŒ (ëŒ€êµ¬ì˜ ì•„ë“¤)</div>
                        <div class="lv-row"><span class="lv-badge lv4">LV.4</span> ë°©ë¬¸ 30íšŒ (ë§›ì˜ ì§€ë°°ì)</div>
                    </div>
                    <p style="font-size:11px; color:#888; margin-top:5px;">â€» ë§Œë ™ ë‹¬ì„± ì‹œ 'ë‹¤ì¦í”¼í”Œ' ì‹œí¬ë¦¿ íŒŒí‹° ì´ˆëŒ€ê¶Œ ì¦ì •!</p>
                </div>
            </div>
            
            <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
            <div style="display:flex; flex-direction:column; gap:10px;">
                <a href="https://open.kakao.com/o/gaV5kk8h" target="_blank" class="panel-btn" style="background:#fee500; color:#3c1e1e;">ğŸ’¬ ëŒ€êµ¬ê²½ë¶ ì°ë§›ì§‘ ì†Œí†µë°©</a>
                <button onclick="openGameModal()" class="panel-btn" style="background:#2c3e50;">ğŸ® ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</button>
                <a href="https://litt.ly/dazzlepeople" target="_blank" class="panel-btn" style="background:#e1306c;">ğŸ“± SNS êµ¬ê²½ê°€ê¸°</a>
            </div>
            
            <div style="padding: 20px 0;">
                <button id="installBtn" class="panel-btn" style="display:none; background:#3498db; color:white; font-size:15px; box-shadow:0 4px 6px rgba(52, 152, 219, 0.3);">â¬‡ï¸ ëŒ€êµ¬ë³´ë¬¼ì§€ë„ ì•± ì„¤ì¹˜í•˜ê¸°</button>
            </div>
        </div>
        <div class="faq-footer"><div class="company-box"><strong>ë‹¤ì¦í”¼í”Œ (ëŒ€í‘œ: ìœ¤ì„±í˜¸)</strong><br>ì‚¬ì—…ìë²ˆí˜¸: 535-25-01793<br>ì£¼ì†Œ: ëŒ€êµ¬ê´‘ì—­ì‹œ ë™êµ¬ ì†¡ë¼ë¡œ16ê¸¸ 42</div></div>
    </div>

    <div id="gameModal" class="modal-overlay">
        <div class="modal-box" style="max-width:400px; padding:0;">
            <button class="modal-close-x" style="z-index:10; top:10px; right:10px;" onclick="closeGameModal()">Ã—</button>
            <div class="game-container" style="padding:25px;">
                <div id="gameMain">
                    <div class="game-title">ğŸ½ï¸ ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</div>
                    <div class="game-selection">
                        <div class="game-card" onclick="startWorldCupGame()"><span class="game-icon">ğŸ†</span><span class="game-name">ìŒì‹ ì›”ë“œì»µ</span><span class="game-desc">í† ë„ˆë¨¼íŠ¸ë¡œ<br>ì‹ ì¤‘í•˜ê²Œ!</span></div>
                        <div class="game-card" onclick="startRouletteGame()"><span class="game-icon">ğŸ¡</span><span class="game-name">ëœë¤ ëŒë¦¼íŒ</span><span class="game-desc">ìš´ëª…ì—<br>ë§¡ê²¨ìš”!</span></div>
                    </div>
                </div>
                <div id="wcGame" class="wc-container"><div class="wc-round-badge" id="wcRoundBadge">16ê°•</div><div class="wc-vs-box"><div class="wc-card" onclick="wcChoose(0)"><div id="wcImgLeft" class="wc-img"></div><div id="wcNameLeft" class="wc-name"></div></div><div style="font-weight:bold; color:#e74c3c; font-style:italic;">VS</div><div class="wc-card" onclick="wcChoose(1)"><div id="wcImgRight" class="wc-img"></div><div id="wcNameRight" class="wc-name"></div></div></div><button onclick="resetGame()" style="font-size:12px; color:#999; border:none; background:none; text-decoration:underline; cursor:pointer;">ì²˜ìŒìœ¼ë¡œ</button></div>
                <div id="wcResult" class="hidden" style="text-align:center;"><div style="font-size:12px; font-weight:bold; color:#888; margin-bottom:10px;">ğŸ‘‘ ìµœí›„ì˜ ìŠ¹ì ğŸ‘‘</div><div id="wcWinnerImg" style="font-size:80px; margin-bottom:10px;"></div><div id="wcWinnerName" style="font-size:24px; font-weight:bold; color:#3498db; margin-bottom:20px;"></div><button onclick="resetGame()" class="spin-btn" style="background:#333;">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button></div>
                <div id="rouletteGame" class="roulette-container"><div class="roulette-mode-btns"><button onclick="setRouletteMode('lunch')" id="btn-lunch" class="roulette-btn active">ì ì‹¬</button><button onclick="setRouletteMode('dinner')" id="btn-dinner" class="roulette-btn">ì €ë…</button><button onclick="setRouletteMode('weekend')" id="btn-weekend" class="roulette-btn">ì£¼ë§</button><button onclick="setRouletteMode('custom')" id="btn-custom" class="roulette-btn" style="color:#3498db; border-color:#3498db;">ë‚´ë§˜ëŒ€ë¡œ</button></div><div id="customInputArea" class="custom-input-box"><div class="custom-input-row"><input type="text" id="customItemInput" class="custom-input" placeholder="ë©”ë‰´ ì…ë ¥" onkeypress="if(event.key==='Enter') addCustomItem()"><button onclick="addCustomItem()" class="custom-add-btn">ì¶”ê°€</button></div><div id="customItemList" class="custom-list"></div></div><div class="roulette-canvas-box"><canvas id="rouletteCanvas" width="560" height="560" class="roulette-canvas"></canvas><div class="roulette-arrow">â–¼</div></div><button id="spinBtn" class="spin-btn" onclick="spinRoulette()">ëŒë ¤ ëŒë ¤! START</button><button onclick="resetGame()" style="margin-top:10px; font-size:12px; color:#999; border:none; background:none; text-decoration:underline; cursor:pointer;">ì²˜ìŒìœ¼ë¡œ</button></div>
            </div>
        </div>
    </div>

    <div id="infoPanel" class="info-panel">
        <div class="panel-header" id="panelHeader"><button class="panel-close" onclick="closePanel()">âœ•</button></div>
        <div class="panel-body">
            <div><h2 class="panel-title" id="panelTitle"></h2><div class="panel-meta" id="panelMeta"></div></div>
            <div class="rating-box"><div class="rating-top"><span class="total-star">â­</span><div class="total-score" id="panelTotal">0.0</div></div><div class="review-text" id="panelReview"></div></div>
            <div class="info-row"><span class="info-label">ë©”ë‰´</span> <span class="info-text" id="panelMenu"></span></div>
            <div class="info-row"><span class="info-label">ì£¼ì†Œ</span> <span class="info-text" id="panelAddr"></span></div>
            <div id="dynamicBtnArea"></div>
            <a href="#" id="panelLink" target="_blank" class="panel-btn">ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë³´ê¸°</a>
        </div>
    </div>

    <div id="profileModal" class="modal-overlay">
        <div class="modal-box">
            <button class="modal-close-x" onclick="document.getElementById('profileModal').classList.remove('show')">Ã—</button>
            <div class="profile-header"><img id="pImg" class="profile-img" src=""><div id="pName" class="profile-name"></div><div id="pLevel" class="profile-level"></div></div>
            <div style="font-size:12px; color:#555; display:flex; justify-content:space-between;"><span>EXP</span><span id="pExpText">0 / 100</span></div>
            <div class="exp-bar-bg"><div id="pExpBar" class="exp-bar-fill"></div></div>
            <h4 style="margin:15px 0 10px 0; border-bottom:1px solid #eee; padding-bottom:5px;">ğŸš© ë°©ë¬¸ ì¸ì¦ ê¸°ë¡</h4>
            <div id="pHistory" class="history-list"></div>
            <button onclick="googleLogout()" style="width:100%; padding:10px; background:#f1f3f5; border:none; border-radius:8px; margin-top:15px; font-weight:bold; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div id="selectModal" class="modal-overlay"><div class="modal-box"><button class="modal-close-x" onclick="closeSelectModal()">Ã—</button><h3 class="modal-title" style="font-size:16px; margin-bottom:15px;">ğŸ‘‡ ë§¤ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3><div id="selectList" class="shop-select-list"></div></div></div>
    
    <div class="bottom-bar">
        <div class="bottom-left"><button class="bar-btn btn-usage" onclick="toggleFaq()">ğŸ“– ì‚¬ìš©ë²•</button><a href="https://www.dazzlepeople.com" target="_blank" class="footer-copyright" style="margin-left:10px;">Â© Dazzle People</a></div>
        <div class="bottom-center"><button class="btn-location-mode" onclick="moveToCurrentLocation()"><div class="loc-icon-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg></div><span class="loc-text">ë‚´ ì£¼ë³€</span></button></div>
        <div class="bottom-right"></div>
    </div>

    <div id="map"></div>

    <script type="module">
        import { db, initMap, createMarker, auth, googleProvider, signInWithPopup, signOut, onAuthStateChanged } from "./common.js";
        import { collection, getDocs, doc, getDoc, setDoc, updateDoc, increment, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        var map = initMap();
        let allShops = [];
        let markerList = [];
        const CACHE_KEY = "dazzle_shops_data_v14_fixed"; 

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js?v=3.0').then(reg => {
                reg.onupdatefound = () => {
                    const installingWorker = reg.installing;
                    installingWorker.onstatechange = () => {
                        if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) { window.location.reload(); }
                    };
                };
            }).catch(err => console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ì‹¤íŒ¨', err));
        }

        let deferredPrompt; 
        const installBtn = document.getElementById('installBtn'); 
        const ua = navigator.userAgent.toLowerCase(); 
        const isIos = /iphone|ipad|ipod/.test(ua); 
        const isInApp = ua.includes('kakao') || ua.includes('instagram') || ua.includes('naver');
        if (isIos) { installBtn.style.display = 'block'; installBtn.addEventListener('click', () => alert("ğŸ“² ì•„ì´í° ì„¤ì¹˜ ë°©ë²•\n\n1. ì‚¬íŒŒë¦¬ í•˜ë‹¨ 'ê³µìœ ' í´ë¦­\n2. 'í™ˆ í™”ë©´ì— ì¶”ê°€' ì„ íƒ")); } 
        else if (isInApp) { installBtn.style.display = 'block'; installBtn.addEventListener('click', () => alert("ğŸš« 'ë”ë³´ê¸°' -> 'ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°'ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.")); } 
        else { window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'block'; }); installBtn.addEventListener('click', (e) => { if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then((r) => { if (r.outcome === 'accepted') installBtn.style.display = 'none'; deferredPrompt = null; }); } }); }

        // ğŸ”¥ [ì¤‘ìš”] ëª¨ë“  UI ì œì–´ í•¨ìˆ˜ë¥¼ window ê°ì²´ì— í• ë‹¹ (HTML onclickì—ì„œ ì¸ì‹ë˜ë„ë¡)
        window.toggleFaq = () => { document.getElementById('faqPanel').classList.toggle('show'); };
        window.closePanel = () => { document.getElementById('infoPanel').classList.remove('show'); };
        window.closeSelectModal = () => { document.getElementById('selectModal').classList.remove('show'); };
        window.openGameModal = () => { window.resetGame(); document.getElementById('gameModal').classList.add('show'); document.getElementById('faqPanel').classList.remove('show'); };
        window.closeGameModal = () => { document.getElementById('gameModal').classList.remove('show'); };

        // --- ê²Œì„ ë¡œì§ (ë‚´ë¶€ ë³€ìˆ˜ ì‚¬ìš© -> window í•¨ìˆ˜ë¡œ ì—°ê²°) ---
        const foodData={lunch:[{name:"ê¹€ì¹˜ì°Œê°œ",img:"ğŸ¥˜"},{name:"ëˆê¹ŒìŠ¤",img:"ğŸ›"},{name:"ì œìœ¡ë³¶ìŒ",img:"ğŸ¥©"},{name:"ìˆœëŒ€êµ­ë°¥",img:"ğŸš"},{name:"í–„ë²„ê±°",img:"ğŸ”"},{name:"ì§œì¥ë©´",img:"ğŸ¥¢"},{name:"ì§¬ë½•",img:"ğŸœ"},{name:"ì¹¼êµ­ìˆ˜",img:"ğŸ²"},{name:"ê¹€ë°¥/ë¼ë©´",img:"ğŸ™"},{name:"ë¹„ë¹”ë°¥",img:"ğŸ¥—"},{name:"ë¶€ëŒ€ì°Œê°œ",img:"ğŸ¥˜"},{name:"ê°€ì •ì‹ë°±ë°˜",img:"ğŸ±"},{name:"ìŒ€êµ­ìˆ˜",img:"ğŸœ"},{name:"ìƒŒë“œìœ„ì¹˜",img:"ğŸ¥ª"},{name:"í¸ì˜ì ",img:"ğŸª"},{name:"ìƒëŸ¬ë“œ",img:"ğŸ¥—"}],dinner:[{name:"ì‚¼ê²¹ì‚´",img:"ğŸ¥“"},{name:"ì¹˜í‚¨",img:"ğŸ—"},{name:"ê³±ì°½/ëŒ€ì°½",img:"ğŸ”¥"},{name:"íšŒ/ì‚¬ì‹œë¯¸",img:"ğŸŸ"},{name:"ì¡±ë°œ/ë³´ìŒˆ",img:"ğŸ–"},{name:"ë§ˆë¼íƒ•",img:"ğŸŒ¶ï¸"},{name:"ì–‘ê¼¬ì¹˜",img:"ğŸ¡"},{name:"í”¼ì",img:"ğŸ•"},{name:"ë‹­ë°œ",img:"ğŸ”¥"},{name:"ì°œë‹­",img:"ğŸ¥˜"},{name:"ê°ˆë¹„",img:"ğŸ¥©"},{name:"ê°ìíƒ•",img:"ğŸ¥˜"},{name:"ì´ìì¹´ì•¼",img:"ğŸ¶"},{name:"íŒŒìŠ¤íƒ€",img:"ğŸ"},{name:"ìŠ¤í…Œì´í¬",img:"ğŸ¥©"},{name:"ì˜¤ëŒë¼ˆ",img:"ğŸ–"}],weekend:[{name:"ë¸ŒëŸ°ì¹˜",img:"ğŸ¥"},{name:"ìƒ¤ë¸Œìƒ¤ë¸Œ",img:"ğŸ²"},{name:"ë°°ë‹¬ì¹˜í‚¨",img:"ğŸ—"},{name:"í”¼ìíŒŒí‹°",img:"ğŸ•"},{name:"ì§œíŒŒê²Œí‹°",img:"ğŸœ"},{name:"ë·”í˜",img:"ğŸ½ï¸"},{name:"ì†Œê³ ê¸°",img:"ğŸ¥©"},{name:"í•´ë¬¼ì°œ",img:"ğŸ™"},{name:"ì§‘ë°¥",img:"ğŸš"},{name:"í¸ì˜ì í„¸ê¸°",img:"ğŸ«"},{name:"íƒ€ì½”/ì´ìƒ‰",img:"ğŸŒ®"},{name:"ëƒ‰ì¥ê³ íŒŒë¨¹ê¸°",img:"ğŸ§Š"},{name:"ë§ˆë¼íƒ•",img:"ğŸŒ¶ï¸"},{name:"ì¡±ë°œ/ë³´ìŒˆ",img:"ğŸ–"},{name:"ì¤‘êµ­ì§‘",img:"ğŸ¥¢"},{name:"ì¹´í˜/ë””ì €íŠ¸",img:"ğŸ°"}]};
        let currentFoods=[],wcCurrentRound=[],wcNextRound=[],wcIndex=0,customFoods=["ì§œì¥ë©´","ì§¬ë½•","íƒ•ìˆ˜ìœ¡"],rCanvas,rCtx,rCurrentRotation=0,isSpinning=false;
        const colors=["#FF9AA2","#FFB7B2","#FFDAC1","#E2F0CB","#B5EAD7","#C7CEEA","#93C5FD","#A78BFA","#FCA5A5","#FDBA74","#FDE047","#86EFAC"];

        window.resetGame = () => { document.getElementById('gameMain').classList.remove('hidden'); document.getElementById('wcGame').style.display='none'; document.getElementById('wcResult').classList.add('hidden'); document.getElementById('rouletteGame').style.display='none'; };
        window.startWorldCupGame = () => { document.getElementById('gameMain').classList.add('hidden'); document.getElementById('wcGame').style.display='flex'; const all=[...foodData.lunch,...foodData.dinner,...foodData.weekend]; const uniq=all.filter((v,i,a)=>a.findIndex(t=>(t.name===v.name))===i); uniq.sort(()=>Math.random()-0.5); wcCurrentRound=uniq.slice(0,16); wcNextRound=[]; wcIndex=0; updateWcMatch(); };
        function updateWcMatch(){ if(wcIndex>=wcCurrentRound.length/2){ wcCurrentRound=[...wcNextRound]; wcNextRound=[]; wcIndex=0; wcCurrentRound.sort(()=>Math.random()-0.5); } if(wcCurrentRound.length===1){ showWcWinner(wcCurrentRound[0]); return; } document.getElementById('wcRoundBadge').innerText=wcCurrentRound.length===2?"ê²°ìŠ¹":wcCurrentRound.length+"ê°•"; const l=wcCurrentRound[wcIndex*2],r=wcCurrentRound[wcIndex*2+1]; document.getElementById('wcImgLeft').innerText=l.img; document.getElementById('wcNameLeft').innerText=l.name; document.getElementById('wcImgRight').innerText=r.img; document.getElementById('wcNameRight').innerText=r.name; }
        window.wcChoose = (s) => { wcNextRound.push(wcCurrentRound[wcIndex*2+s]); wcIndex++; updateWcMatch(); };
        function showWcWinner(w){ document.getElementById('wcGame').style.display='none'; document.getElementById('wcResult').classList.remove('hidden'); document.getElementById('wcWinnerImg').innerText=w.img; document.getElementById('wcWinnerName').innerText=w.name; fireConfetti(); }
        window.startRouletteGame = () => { document.getElementById('gameMain').classList.add('hidden'); document.getElementById('rouletteGame').style.display='flex'; initRoulette(); window.setRouletteMode('lunch'); };
        function initRoulette(){ rCanvas=document.getElementById('rouletteCanvas'); rCtx=rCanvas.getContext('2d'); }
        window.setRouletteMode = (m) => { if(isSpinning)return; document.querySelectorAll('.roulette-btn').forEach(b=>b.classList.remove('active')); document.getElementById(`btn-${m}`).classList.add('active'); if(m==='custom'){ currentFoods=[...customFoods]; document.getElementById('customInputArea').style.display='block'; renderCustomItems(); }else{ currentFoods=foodData[m].map(i=>i.name); document.getElementById('customInputArea').style.display='none'; } drawRoulette(); };
        window.addCustomItem = () => { const v=document.getElementById('customItemInput').value.trim(); if(v){ customFoods.push(v); currentFoods=[...customFoods]; document.getElementById('customItemInput').value=''; renderCustomItems(); drawRoulette(); } };
        window.removeCustomItem = (i) => { customFoods.splice(i,1); currentFoods=[...customFoods]; renderCustomItems(); drawRoulette(); };
        function renderCustomItems(){ document.getElementById('customItemList').innerHTML=customFoods.map((t,i)=>`<span class="custom-tag">${t} <span class="custom-tag-del" onclick="removeCustomItem(${i})">Ã—</span></span>`).join(''); }
        function drawRoulette(){ if(!rCanvas)return; const n=currentFoods.length; if(n===0){ rCtx.clearRect(0,0,rCanvas.width,rCanvas.height); return; } const arc=(2*Math.PI)/n,dpr=window.devicePixelRatio||1,rect=rCanvas.getBoundingClientRect(); rCanvas.width=rect.width*dpr; rCanvas.height=rect.height*dpr; rCtx.scale(dpr,dpr); const r=rect.width/2; rCtx.clearRect(0,0,rect.width,rect.height); for(let i=0;i<n;i++){ const a=i*arc-Math.PI/2; rCtx.beginPath(); rCtx.moveTo(r,r); rCtx.arc(r,r,r,a,a+arc); rCtx.fillStyle=colors[i%colors.length]; rCtx.fill(); rCtx.stroke(); rCtx.save(); rCtx.translate(r,r); rCtx.rotate(a+arc/2); rCtx.textAlign="right"; rCtx.fillStyle="#333"; const fs=Math.max(12,Math.min(24,200/n)); rCtx.font=`bold ${fs}px 'Noto Sans KR'`; rCtx.fillText(currentFoods[i],r-20,5); rCtx.restore(); } }
        window.spinRoulette = () => { if(isSpinning)return; if(currentFoods.length<2){ alert("ë©”ë‰´ 2ê°œ ì´ìƒ í•„ìš”!"); return; } isSpinning=true; document.getElementById('spinBtn').innerText="...DoRoRo..."; const r=Math.floor(Math.random()*360); rCurrentRotation+=(360*5+r); rCanvas.style.transition="transform 4s cubic-bezier(0.25,0.1,0.25,1)"; rCanvas.style.transform=`rotate(${rCurrentRotation}deg)`; setTimeout(()=>{ isSpinning=false; document.getElementById('spinBtn').innerText="ëŒë ¤ ëŒë ¤! START"; fireConfetti(); },4000); };
        function fireConfetti(){ const c=['#f00','#0f0','#00f','#ff0','#0ff']; for(let i=0;i<50;i++){ const d=document.createElement('div'); d.className='confetti'; d.style.left=Math.random()*100+'vw'; d.style.top='-10px'; d.style.backgroundColor=c[Math.floor(Math.random()*c.length)]; d.style.animationDuration=(Math.random()*2+2)+'s'; document.body.appendChild(d); setTimeout(()=>d.remove(),4000); } }

        // --- ì´ˆê¸°í™” ---
        async function initApp() { await initTheme(); await loadShopsData(); }

        async function initTheme() {
            const select = document.getElementById('mainThemeSelect');
            select.innerHTML = ''; 
            let firstTheme = null;
            try {
                const docRef = doc(db, "meta", "themes");
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    let list = docSnap.data().list || [];
                    list.sort(); 
                    list.forEach((t, index) => {
                        const opt = document.createElement('option'); opt.value = t; opt.innerText = `ğŸš© ${t}`; select.appendChild(opt);
                        if (index === 0) firstTheme = t;
                    });
                }
                const allOpt = document.createElement('option'); allOpt.value = "ALL"; allOpt.innerText = "ğŸ’ ì „ì²´ ë§›ì§‘ ë³´ê¸°"; select.appendChild(allOpt); 
                if (firstTheme) select.value = firstTheme; else select.value = "ALL";
            } catch(e) { console.error("í…Œë§ˆ ë¡œë”© ì‹¤íŒ¨", e); }
        }

        async function loadShopsData() {
            const cachedData = localStorage.getItem(CACHE_KEY);
            const cachedTime = localStorage.getItem(CACHE_KEY + "_time");
            const now = new Date().getTime();
            let isCacheUsed = false;
            if (cachedData && cachedTime && (now - cachedTime < 30 * 60 * 1000)) {
                try {
                    const parsed = JSON.parse(cachedData);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        allShops = parsed;
                        checkAndRender();
                        document.getElementById('loadingOverlay').classList.add('fade-out');
                        isCacheUsed = true;
                    }
                } catch (err) { }
            }
            if (!isCacheUsed && db) {
                try {
                    const snapshot = await getDocs(collection(db, "shops"));
                    allShops = [];
                    snapshot.forEach((doc) => allShops.push({ id: doc.id, ...doc.data() }));
                    localStorage.setItem(CACHE_KEY, JSON.stringify(allShops));
                    localStorage.setItem(CACHE_KEY + "_time", now);
                    document.getElementById('loadingOverlay').classList.add('fade-out');
                    checkAndRender();
                } catch (e) { console.error(e); }
            }
        }

        function checkAndRender() { 
            if (!map) return; 
            const bounds = map.getBounds();
            if (!bounds || !(bounds instanceof naver.maps.LatLngBounds)) { setTimeout(checkAndRender, 100); return; }
            updateVisibleMarkers(); 
        }

        function filterShops(shops) {
            var theme = $('#mainThemeSelect').val();
            if (!theme) return []; 
            var region = $('#filterRegion').val();
            var category = $('#filterCategory').val();
            var purpose = $('#filterPurpose').val();
            var keywordInput = $('#keyword').val() || "";
            var keywords = keywordInput.toLowerCase().trim().split(/\s+/).filter(t => t.length > 0);
            const user = auth.currentUser;
            return shops.filter(shop => {
                if (isLikeFilterOn) { if (!user || !shop.likedBy || !shop.likedBy.includes(user.uid)) return false; }
                if (theme === 'ALL') {
                    let fullInfo = "";
                    if (shop.category) fullInfo += (Array.isArray(shop.category) ? shop.category.join(" ") : shop.category);
                    if (shop.purpose) fullInfo += (Array.isArray(shop.purpose) ? shop.purpose.join(" ") : shop.purpose);
                    if (shop.name) fullInfo += shop.name;
                    if (fullInfo.includes("ì£¼ì°¨ì¥")) return false;
                } else {
                    if (!shop.themes || !Array.isArray(shop.themes) || !shop.themes.includes(theme)) return false;
                }
                var matchRegion = (region === "") || (shop.region === region);
                var shopCategories = Array.isArray(shop.category) ? shop.category : [shop.category];
                var matchCategory = (category === "") || shopCategories.includes(category);
                var shopPurposes = Array.isArray(shop.purpose) ? shop.purpose : [shop.purpose];
                var matchPurpose = (purpose === "") || shopPurposes.includes(purpose);
                var catString = shopCategories.join(" ") || "";
                var searchableText = (shop.name + " " + (shop.menu || "") + " " + (shop.area || "") + " " + (shop.address || "") + " " + catString).toLowerCase();
                var matchKeyword = true;
                if (keywords.length > 0) { matchKeyword = keywords.every(term => searchableText.includes(term)); }
                return matchRegion && matchCategory && matchPurpose && matchKeyword;
            });
        }

        function updateVisibleMarkers() {
            if (!map) return;
            const bounds = map.getBounds();
            if (!bounds) { setTimeout(updateVisibleMarkers, 100); return; }
            const filtered = filterShops(allShops);
            renderMarkers(filtered);
        }

        function renderMarkers(shops) {
            markerList.forEach(m => m.setMap(null)); markerList = [];
            const groups = {};
            shops.forEach(shop => {
                const key = parseFloat(shop.lat).toFixed(5) + "," + parseFloat(shop.lng).toFixed(5);
                if(!groups[key]) groups[key] = [];
                groups[key].push(shop);
            });
            for(const key in groups) {
                groups[key].sort((a, b) => {
                    const pA = a.priority || 0; const pB = b.priority || 0;
                    if (pA !== pB) return pB - pA;
                    const hotA = a.isHot ? 1 : 0; const hotB = b.isHot ? 1 : 0;
                    if (hotA !== hotB) return hotB - hotA;
                    return 0;
                });
                const marker = createMarker(map, groups[key], function(clickedList) {
                    if (clickedList.length === 1) window.showPanel(clickedList[0]);
                    else window.showSelectModal(clickedList);
                });
                if(marker) markerList.push(marker);
            }
        }

        window.showPanel = function(shop) {
            document.getElementById('panelTitle').innerText = shop.name;
            const score = shop.totalScore || "0.0";
            document.getElementById('panelTotal').innerHTML = `${score}<span class="total-max"> / 5.0</span>`;
            document.getElementById('panelMenu').innerText = shop.menu || "-";
            document.getElementById('panelAddr').innerText = shop.address || "-";
            const reviewHtml = shop.desc ? `ğŸ—¨ï¸ "${shop.desc}"` : `ğŸ—¨ï¸ "ì•„ì§ ë“±ë¡ëœ í•œì¤„í‰ì´ ì—†ì–´ìš”."`;
            document.getElementById('panelReview').innerHTML = reviewHtml;
            const metaBox = document.getElementById('panelMeta');
            let metaHtml = '';
            if(shop.category) (Array.isArray(shop.category) ? shop.category : [shop.category]).forEach(c => metaHtml += `<span class="panel-tag">#${c}</span>`);
            if(shop.purpose) (Array.isArray(shop.purpose) ? shop.purpose : [shop.purpose]).forEach(p => metaHtml += `<span class="panel-tag">#${p}</span>`);
            metaBox.innerHTML = metaHtml;
            const header = document.getElementById('panelHeader');
            if (shop.imageUrl) { header.style.backgroundImage = `url('${shop.imageUrl}')`; } 
            else { header.style.backgroundImage = 'none'; header.style.backgroundColor = '#ddd'; }
            let parkingBadge = '';
            if (shop.parking) { parkingBadge = `<div class="parking-badge">${shop.parking}</div>`; }
            const user = auth.currentUser;
            const likedList = shop.likedBy || [];
            const isLiked = user && likedList.includes(user.uid);
            const heartIcon = isLiked ? "â¤ï¸" : "ğŸ¤";
            const likeCount = likedList.length;
            const heartHtml = `<div class="like-btn-wrapper"><button id="heartBtn" class="heart-btn ${isLiked?'active':''}" onclick="toggleLike('${shop.id}')">${heartIcon}</button><span id="likeCountSpan" class="like-count">${likeCount}</span></div>`;
            header.innerHTML = `<button class="panel-close" onclick="closePanel()">âœ•</button>${parkingBadge}${heartHtml}`;
            const dynamicBtnArea = document.getElementById('dynamicBtnArea');
            dynamicBtnArea.innerHTML = `<button class="panel-btn" style="background:#e74c3c; margin-bottom:5px;" onclick="verifyVisitByGPS(${shop.lat}, ${shop.lng}, '${shop.name}')">ğŸ“ <b>ì—¬ê¸° ì™”ì–´ìš”! (GPS ì¸ì¦)</b></button>`;
            if (user && shop.ownerId && shop.ownerId === user.uid) {
                dynamicBtnArea.innerHTML += `<button class="panel-btn" style="background:#2c3e50; margin-bottom:5px;" onclick="location.href='admin_dz_map11.html'">ğŸ”§ ë‚´ ê°€ê²Œ ì •ë³´ ìˆ˜ì •í•˜ê¸°</button>`;
            }
            const btnLink = document.getElementById('panelLink');
            if (shop.link) { btnLink.href = shop.link; btnLink.style.display = 'block'; btnLink.innerText = 'ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë³´ê¸°'; } 
            else { btnLink.href = '#'; btnLink.style.display = 'none'; }
            document.getElementById('faqPanel').classList.remove('show');
            document.getElementById('selectModal').classList.remove('show');
            document.getElementById('infoPanel').classList.add('show');
        }

        window.toggleLike = async function(shopId) {
            const user = auth.currentUser;
            if(!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ğŸ˜…");
            const heartBtn = document.getElementById('heartBtn');
            const countSpan = document.getElementById('likeCountSpan');
            const shopRef = doc(db, "shops", shopId);
            const isLiked = heartBtn.innerText === "â¤ï¸";
            if(isLiked) { heartBtn.innerText = "ğŸ¤"; heartBtn.classList.remove('active'); countSpan.innerText = parseInt(countSpan.innerText) - 1; } 
            else { heartBtn.innerText = "â¤ï¸"; heartBtn.classList.add('active'); countSpan.innerText = parseInt(countSpan.innerText) + 1; }
            try {
                if(isLiked) await updateDoc(shopRef, { likedBy: arrayRemove(user.uid) });
                else await updateDoc(shopRef, { likedBy: arrayUnion(user.uid) });
                const target = allShops.find(s => s.id === shopId);
                if(target) {
                    if(!target.likedBy) target.likedBy = [];
                    if(isLiked) target.likedBy = target.likedBy.filter(uid => uid !== user.uid);
                    else target.likedBy.push(user.uid);
                }
            } catch(e) { console.error(e); heartBtn.innerText = isLiked ? "â¤ï¸" : "ğŸ¤"; }
        }

        window.verifyVisitByGPS = function(shopLat, shopLng, shopName) {
            const user = auth.currentUser;
            if(!user) return alert("ë¡œê·¸ì¸ í›„ ì¸ì¦ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            const btn = event.target; const originalText = btn.innerHTML;
            const userRef = doc(db, "users", user.uid);
            getDoc(userRef).then(snap => {
                if(snap.exists()) {
                    const data = snap.data();
                    const last = data.lastCheckIn ? data.lastCheckIn.toMillis() : 0;
                    if ((new Date().getTime() - last) / (1000 * 60) < 60) return alert("1ì‹œê°„ì— 1ë²ˆë§Œ ì¸ì¦ ê°€ëŠ¥í•´ìš”!");
                    if(!navigator.geolocation) return alert("GPS ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
                    btn.innerText = "ğŸ“¡ ìœ„ì¹˜ í™•ì¸ ì¤‘..."; btn.disabled = true;
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        const dist = getDistanceFromLatLonInKm(pos.coords.latitude, pos.coords.longitude, shopLat, shopLng);
                        if(dist < 100) {
                            await updateDoc(userRef, { exp: increment(10), lastCheckIn: new Date() });
                            alert(`ğŸ‰ ì¸ì¦ ì„±ê³µ! ê²½í—˜ì¹˜ +10`); location.reload();
                        } else {
                            alert(`ë§¤ì¥ ê·¼ì²˜ê°€ ì•„ë‹™ë‹ˆë‹¤. (ê±°ë¦¬: ${Math.round(dist)}m)`); btn.innerHTML = originalText; btn.disabled = false;
                        }
                    }, () => { alert("ìœ„ì¹˜ ì‹¤íŒ¨"); btn.innerHTML = originalText; btn.disabled = false; });
                }
            });
        }
        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            var R=6371; var dLat=deg2rad(lat2-lat1); var dLon=deg2rad(lon2-lon1);
            var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(deg2rad(lat1))*Math.cos(deg2rad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);
            var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)); return R*c*1000;
        }
        function deg2rad(deg) { return deg*(Math.PI/180); }

        window.openProfileModal = async function() {
            const user = auth.currentUser;
            if(!user) return;
            const userRef = doc(db, "users", user.uid);
            const snap = await getDoc(userRef);
            if(snap.exists()) {
                const data = snap.data();
                const lv = 1 + Math.floor((data.exp||0)/10);
                document.getElementById('pImg').src = user.photoURL;
                document.getElementById('pName').innerText = user.displayName;
                document.getElementById('pLevel').innerText = `LV.${lv} (ë¯¸ì‹ê°€)`;
                document.getElementById('pExpText').innerText = `${data.exp||0} EXP`;
                document.getElementById('pExpBar').style.width = Math.min((data.exp%10)*10, 100) + '%';
                document.getElementById('profileModal').classList.add('show');
            }
        }

        window.showSelectModal = function(list) {
            const container = document.getElementById('selectList'); container.innerHTML = '';
            list.forEach(shop => {
                const div = document.createElement('div'); div.className = 'shop-select-item';
                div.innerText = shop.name;
                div.onclick = () => { window.closeSelectModal(); window.showPanel(shop); };
                container.appendChild(div);
            });
            document.getElementById('selectModal').classList.add('show');
        }
        window.moveToCurrentLocation = function() {
            if (!navigator.geolocation) { alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
            const btnText = document.querySelector('.loc-text');
            if(btnText) btnText.innerText = "íƒìƒ‰ì¤‘..";
            navigator.geolocation.getCurrentPosition((position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                map.setCenter(new naver.maps.LatLng(lat, lng)); map.setZoom(16);
                setTimeout(() => { updateVisibleMarkers(); if(btnText) btnText.innerText = "ë‚´ ì£¼ë³€"; }, 300);
            }, () => { alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); if(btnText) btnText.innerText = "ë‚´ ì£¼ë³€"; });
        }
        
        let isLikeFilterOn = false;
        window.toggleLikeFilter = function() {
            isLikeFilterOn = !isLikeFilterOn;
            const btn = document.getElementById('btnShowLikes');
            btn.style.background = isLikeFilterOn ? "#e74c3c" : "white";
            btn.style.color = isLikeFilterOn ? "white" : "#e74c3c";
            updateVisibleMarkers();
        }
        
        window.applyAllFilters = function() { updateVisibleMarkers(); };
        window.googleLogin = function() { signInWithPopup(auth, googleProvider).then((r)=>{alert("ë¡œê·¸ì¸ ì„±ê³µ"); location.reload();}); }
        window.googleLogout = function() { if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { signOut(auth).then(() => { location.reload(); }); } };
        
        onAuthStateChanged(auth, (user) => {
            if(user) { document.getElementById('btnLogin').style.display='none'; document.getElementById('myProfile').style.display='flex'; document.getElementById('userName').innerText = user.displayName; }
        });

        initApp(); 
    </script>
</body>
</html>